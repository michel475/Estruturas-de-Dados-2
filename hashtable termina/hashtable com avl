#include <stdio.h>
#include <stdlib.h>

typedef struct arv{
	int dado;
	int altura;
	struct arv *esq;
	struct arv *dir;
} *Arv;


struct hash{
	int qtd, ts;
	Arv *itens;
};

typedef struct hash Hash;

Hash* criacaohash(int ts)
{
	Hash *ha = (Hash*)malloc(sizeof(Hash));
	if(ha != NULL)
	{
		ha->itens = (Arv*)malloc(ts * sizeof(Arv));
		ha->ts = ts;
		ha->qtd = 0;
		int i;
		for(i=0; i<ts; i++)
			ha->itens[i] = NULL;
	}
	return ha;
}


int alturaNo(Arv A)
{
	return A->altura;
}

int maior(int x, int y)
{
	return x > y ? x : y;
}

int fatorbalno(Arv A)
{
	return alturaNo(A->esq) - alturaNo(A->dir);
}


void rotacaoLL(Arv *A)
{
	if(A == NULL)
		return;
	Arv B = (*A)->esq;
	(*A)->esq = B->dir;
	B->dir = *A;
	(*A)->altura = maior(alturaNo((*A)->esq), alturaNo((*A)->dir))+1;
	B->altura = maior(alturaNo(B->esq), alturaNo(B->dir))+1;
}

void rotacaoRR(Arv *A)
{
	if(A == NULL)
		return;
	Arv B = (*A)->dir;
	(*A)->dir = B->esq;
	B->esq = *A;
	(*A)->altura = maior(alturaNo((*A)->esq), alturaNo((*A)->dir))+1;
	B->altura = maior(alturaNo(B->esq), alturaNo(B->dir))+1;
}

void rotacaoLR(Arv *A)
{
	rotacaoRR(&(*A)->esq);
	rotacaoLL(A);
}

void rotacaoRL(Arv *A)
{
	rotacaoLL(&(*A)->dir);
	rotacaoRR(A);
}

int inserir(Arv *A, int dado)
{
	if(A == NULL)
		return 0;
	if(*A == NULL)
	{
		Arv novo = (Arv)malloc(sizeof(struct arv));
		if(novo == NULL)
			return 0;
		novo->dado = dado;
		novo->altura = 0;
		novo->esq = novo->dir = NULL;
		*A = novo;
		return 1;
	}
	else{
		if(dado <= (*A)->dado)
			return inserir(&(*A)->esq, dado);
		else
			return inserir(&(*A)->dir, dado);
	}
	
	if(*A != NULL)
	{
		(*A)->altura = maior(alturaNo((*A)->esq), alturaNo((*A)->dir))+1;
	}
	
	if(fatorbalno(*A) > 1)
	{
		if(fatorbalno((*A)->esq) >= 0)
			rotacaoLL(A);
		else
			rotacaoLR(A);
	}
	else{
		if(fatorbalno(*A) < -1)
		{
			if(fatorbalno((*A)->dir) <= 0)
				rotacaoRR(A);
			else
				rotacaoRL(A);
		}
	}
}

int removemax(Arv *A)
{
	if(A == NULL)
		return 0;
	while((*A)->dir != NULL)
		A = &(*A)->dir;
	int a = (*A)->dado;
	Arv B = (*A)->esq;
	free(*A);
	*A = B;
	return a;
}

int remover(Arv *A, int dado)
{
	if(A == NULL)
		return 0;
	if(dado == (*A)->dado)
	{
		if((*A)->esq == NULL && (*A)->dir == NULL)
		{
			free(*A);
			*A = NULL;
		}
		else{
			if((*A)->esq == NULL && (*A)->dir != NULL)
			{
				Arv B = (*A)->dir;
				free(*A);
				*A = B;
			}
			else{
				if((*A)->esq != NULL && (*A)->dir == NULL)
				{
					Arv B = (*A)->esq;
					free(*A);
					*A = B;
				}
				else{
					if((*A)->esq != NULL && (*A)->dir != NULL)
					{
						int a = removemax(&(*A)->esq);
						(*A)->dado = a;
					}
				}
			}
		}
		return 1;
	}
	else{
		if(dado < (*A)->dado)
			return remover(&(*A)->esq, dado);
		else
			return remover(&(*A)->dir, dado);
	}
	
	if(*A != NULL)
	{
		(*A)->altura = maior(alturaNo((*A)->esq), alturaNo((*A)->dir))+1;
	}
	
	if(fatorbalno(*A) > 1)
	{
		if(fatorbalno((*A)->esq) >= 0)
			rotacaoLL(A);
		else
			rotacaoLR(A);
	}
	else{
		if(fatorbalno(*A) < -1)
		{
			if(fatorbalno((*A)->dir) <= 0)
				rotacaoRR(A);
			else
				rotacaoRL(A);
		}
	}
}

int busca(Arv A, int dado)
{
	if(A == NULL)
		return 0;
	if(dado == A->dado)
		return 1;
	else{
		if(dado < A->dado)
			return busca(A->esq, dado);
		else
			return busca(A->dir, dado);
	}
}

void emordem(Arv A)
{
	if(A == NULL)
		return;
	emordem(A->esq);
	printf("%d ", A->dado);
	emordem(A->dir);
}

int funcaohashing(int chave, int ts)
{
	return(chave & 0x7FFFFFFF) % ts;
}

int insercaoH(Hash *ha, int dado)
{
	if(ha == NULL)
		return 0;
	int indice = funcaohashing(dado, ha->ts);
	inserir(&ha->itens[indice], dado);
	ha->qtd+=1;
	return 1;
}

int buscaH(Hash *ha, int dado)
{
	if(ha == NULL)
		return 0;
	int indice = funcaohashing(dado, ha->ts);
	return busca(ha->itens[indice], dado);
}


int main()
{
	Hash *ha = criacaohash(10);
	insercaoH(ha, 6);
	insercaoH(ha, 6);
	insercaoH(ha, 6);
	insercaoH(ha, 6);
	insercaoH(ha, 4);
	insercaoH(ha, 4);
	insercaoH(ha, 4);
	insercaoH(ha, 4);
	int indice = (6 & 0x7FFFFFFF) % ha->ts;
	int indice2 = (4 & 0x7FFFFFFF) % ha->ts;
	printf(busca(ha->itens[indice], 7) ? "sim\n" : "nao\n");
	emordem(ha->itens[indice]);
	printf("\n");
	emordem(ha->itens[indice2]);
	printf(buscaH(ha, 6) ? "existe\n" : "nao\n");
}
